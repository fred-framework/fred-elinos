# PikeOS Integration Project for FRED

This PikeOS Integration Project is used to deploy an ElinOS version
containing the FRED Framework onto a Xilinx Ultrascale+ ZCU102 Evaluation
Board.

This directory contains all the information needed to build the final boot
image containing both PikeOS and the ElinOS image that will run within the
hypervisor. It also completes the creation of a `rootfs` suitable for
flashing onto an SD Card.

> **Please refrain from manually building this integration project by
> itself. Instead, use the `build.sh` and the `burn.sh` scripts in the
> top-level directory to do so. Refer to [../README.md](../README.md) for
> further info.**

## Missing Features

> If you use the project "as is", no manual intervention is required.

However, if you want to change something you might have to manually update
some files in the project; this includes:
 - Configuring shared memory regions among the `fred-server`, any Fred
   client application, and the FPGA Manager. PikeOS must be instructed to
   allow communication in those memory regions via UIO, if the size of the
   region changes.

___________________________________________________________________________

## Useful information for debugging purposes

### Project Target

The main file generated by this project is the following:
```
boot/hwvirt-linux-zynq-zcu102-hwvirt-uboot_dtb
```
This file contains both PikeOS and ElinOS kernel image.

This project collects also all the files to be put in the `rootfs` partition on
the SD Card and archives them. This archive can then later be extracted to the
SD Card to update it.

### Booting PikeOS with ElinOS inside

> **NOTE**: U-Boot should be built separately. For convenience, this
> project provides both a U-Boot binary and a U-Boot Script, both already
> compiled for the target platform.

You can instruct U-Boot from its terminal to load this image and boot it
with the two following commands (assuming you placed this file in the
U-Boot directory):
```bash
fatload mmc 0 0x10000000 hwvirt-linux-zynq-zcu102-hwvirt-uboot_dtb
bootm 0x10000000
```

This is not so convenient, so the `burn.sh` script will rename this file to
**`image.ub`**. The provided **`boot.scr`** script will then naturally look for
that file and load it accordingly. So, again, if you use the `build.sh`/`burn.sh`
script, no action is needed, and you can easily burn your SD Card, plug it
into the board and boot it up unprompted.

### Committing Changes to PikeOS Configuration

> **NOTE**: you must have a valid PikeOS license and a license server
> running on your host to run this step.

Before re-running the `build.sh` script, export the changes that you made
to the project in CODEO/Eclipse (or your editor of choice) by running:
```bash
PATH_TO_PIKEOS_INSTALLATION/bin/pikeos-share-project export
```

You can now re-run the `build.sh` script and everything will be updated
accordingly.

<!--
## Diff PikeOS configuration

In the future, when migrating to newer PikeOS version, it will be useful to
know all the configurations done manually in CODEO. For this reason, run
the command `make diffconfig` to highlight those differences compared to
the default PikeOS config. Then, it's is just a matter of finding each
parameter in the newer CODEO/PikeOS.

A. Amory
-->
